#!/usr/bin/env python

import os, sys, argparse, time
from mixcoatl.geography.region import Region
from mixcoatl import utils
from prettytable import PrettyTable

if __name__ == '__main__':
    """ List regions. """
    start = time.time()
    parser = argparse.ArgumentParser()
    group_one = parser.add_mutually_exclusive_group()
    group_one.add_argument('--json', action='store_true', help='print API response in JSON format.')
    group_one.add_argument('--xml', action='store_true', help='print API response in XML format.')
    cmd_args = parser.parse_args()

    regions = Region.all()

    if cmd_args.xml is True or cmd_args.json is True:
        if cmd_args.xml is True:
            payload_format = 'xml'
        else:
            payload_format = 'json'

        print utils.print_format(regions, payload_format)
    else:
        table = PrettyTable(["Region ID", "Provider ID", "Cloud", "Region Name", "Description", "Status"])
        for r in regions['regions']:
            table.add_row([
                r['regionId'],
                r['providerId'],
                r.cloud['cloud_provider_name'] if hasattr(r,'cloud_provider_name') else r['cloud']['cloudId'],
                r.name if hasattr(r, 'name') else r['regionId'],
                r['description'],
                r['status']])
        table.align = 'l'
        print(table)

    if 'DCM_DEBUG' in os.environ:
        print 'Results returned in', time.time()-start, 'seconds.'
