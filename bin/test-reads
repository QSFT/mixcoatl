#!/usr/bin/env python

import os, string, random, argparse, sys, time
from termcolor import colored
from prettytable import PrettyTable
from datetime import datetime
from mixcoatl.admin.account import Account
from mixcoatl.geography.cloud import Cloud
from mixcoatl.geography.region import Region
from mixcoatl.network.firewall import Firewall
from mixcoatl.network.firewall_rule import FirewallRule
from mixcoatl.network.load_balancer import LoadBalancer
from mixcoatl.geography.datacenter import DataCenter
from mixcoatl.network.network import Network
from mixcoatl.infrastructure.machine_image import MachineImage
from mixcoatl.infrastructure.server_product import ServerProduct
from mixcoatl.admin.billing_code import BillingCode
from mixcoatl.infrastructure.server import Server
from mixcoatl.infrastructure.volume import Volume
from mixcoatl.infrastructure.snapshot import Snapshot
from mixcoatl.geography.subscription import Subscription
from mixcoatl.admin.group import Group
from mixcoatl.admin.user import User
from mixcoatl.automation.configuration_management_account import ConfigurationManagementAccount
from mixcoatl.automation.configuration_management_service import ConfigurationManagementService
from mixcoatl.admin.job import Job
# from mixcoatl.automation.script import Script
# from mixcoatl.automation.personality import Personality
# from mixcoatl.automation.environment import Environment

print "Starting Mixcoatl 'GET' testing ..."
total_start = time.time()

try:
	region_id = random.choice(Region.all(keys_only=True))
	print "++ Defaulting to Region #"+str(region_id)
except:
	print "++ Unable to retrieve any regions."

try:
	firewall_id = random.choice(Firewall.all(keys_only=True))
	print "++ Defaulting to Firewall #"+str(firewall_id)
except:
	print "++ Unable to retrieve a firewall."

try:
	cm_id = random.choice(ConfigurationManagementAccount.all(keys_only=True))
	print "++ Defaulting to CM Account #"+str(cm_id)
except:
	print "++ Unable to retrieve a cm account."

tests = ['Region', 'Firewall', 'FirewallRule', 'Cloud', 'Account', 'Group', 'DataCenter', 'MachineImage', 'Network', 'LoadBalancer', 'BillingCode', 'Server', 'ServerProduct', 'Volume', 'Role', 'Snapshot', 'Subscription', 'ConfigurationManagementAccount', 'ConfigurationManagementService', 'Job', 'User']

for i in sorted(tests):
	params = None
	start = time.time()

	if i == 'DataCenter' or i == 'MachineImage' or i == 'ServerProduct':
		params = region_id
	elif i == 'FirewallRule':
		params = firewall_id

	if params is not None:
		print i+'.all('+str(params)+')',
		call = getattr(sys.modules[__name__],i).all(params)
	else:
		print i+'.all()',
		call = getattr(sys.modules[__name__],i).all()

	try:
		if call is not None:
			print 'returned in', round(time.time()-start,3), 'seconds. ',
			print '[ '+colored('OK', 'green')+' ]'
	except:
		print '[ '+colored('FAIL', 'red')+' ]'

print '++ Script finished in', round(time.time()-total_start,3), 'seconds. ',

